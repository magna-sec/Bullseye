---
- name: Run the equivalent of "apt update"
  apt:
    update_cache: yes

- name: Remove apt lock-frontend file
  file:
    state: absent
    path: "/var/lib/dpkg/lock-frontend"

- name: Remove apt lock file
  file:
    state: absent
    path: "/var/lib/dpkg/lock"

- name: Upgrade all packages to their latest version
  apt:
    upgrade: yes

# Installing packages
- name: Install quality of life packages
  ansible.builtin.package:
    name: "{{ item }}"
    state: present
  loop: "{{ InitialPackages }}"

- name: Add the user scr 
  ansible.builtin.user:
    name: "{{ StudentUser }}"
    password: "{{ StudentPass }}"
    shell: /bin/bash
    comment: Get good

- name: Edit /etc/ssh/sshd_config to allow scr group to SSH - Shell
  ansible.builtin.shell:
    cmd: echo "AllowUsers {{ StudentUser }} magna" >> /etc/ssh/sshd_config

- name: Restart service ssh, in all cases
  ansible.builtin.service:
    name: ssh
    state: restarted